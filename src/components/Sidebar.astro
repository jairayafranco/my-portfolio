---
import { Icon } from "astro-icon/components";
import LanguagePicker from "./LanguagePicker.astro";
import Social from "./Social.astro";
import {
    getLangFromUrl,
    useTranslations,
    useTranslatedPath,
} from "../i18n/utils";
import type { SidebarItem } from "../types";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);
const currentPath = Astro.url.pathname;

const sidebarItems: SidebarItem[] = [
    {
        name: t("sidebar.home"),
        icon: "iconoir:home",
        link: "/",
    },
    {
        name: t("sidebar.projects"),
        icon: "grommet-icons:projects",
        link: "/projects/",
    },
    {
        name: "CV",
        icon: "mdi:paper-text-outline",
        link: "/cv/",
    },
];

const isProjectsPage =
    currentPath.includes("/proyectos") || currentPath.includes("/projects");
---

<!-- Mobile navigation -->
<nav
    class="flex gap-3 items-center py-3 ml-8 sticky top-0 z-50 backdrop-blur-xl bg-slate-900/80 border-b border-white/10 lg:hidden"
    aria-label="Mobile navigation"
>
    <ul class="flex gap-4">
        {
            sidebarItems.map((item) => {
                const itemPath = translatePath(item.link, lang);
                const isActive = currentPath === itemPath;

                return (
                    <li>
                        <a
                            href={itemPath}
                            class:list={[
                                "font-medium dark:text-white hover:opacity-80 transition-opacity",
                                { underline: isActive },
                            ]}
                            aria-current={isActive ? "page" : undefined}
                        >
                            {item.name}
                        </a>
                    </li>
                );
            })
        }
    </ul>
    <LanguagePicker />
</nav>

<!-- Desktop sidebar -->
<aside
    id="logo-sidebar"
    class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0"
    aria-label="Main navigation"
>
    <div
        class="h-full px-3 py-4 overflow-y-auto backdrop-blur-xl bg-slate-900/50 border-r border-white/10"
    >
        <nav aria-label="Main menu">
            <ul class="space-y-2 font-medium">
                {
                    sidebarItems.map((item) => {
                        const itemPath = translatePath(item.link, lang);
                        const isActive = currentPath === itemPath;

                        return (
                            <li>
                                <a
                                    href={itemPath}
                                    class:list={[
                                        "flex items-center p-3 text-gray-900 rounded-xl dark:text-white hover:bg-gradient-to-r hover:from-purple-500/20 hover:to-blue-500/20 group transition-all duration-300 hover:shadow-lg hover:shadow-purple-500/20 hover:translate-x-1",
                                        {
                                            "bg-gradient-to-r from-purple-500/30 to-blue-500/30 shadow-lg shadow-purple-500/30":
                                                isActive,
                                        },
                                    ]}
                                    aria-current={isActive ? "page" : undefined}
                                >
                                    <Icon
                                        name={item.icon}
                                        width="32px"
                                        aria-hidden="true"
                                    />
                                    <span class="ml-3">{item.name}</span>
                                </a>
                            </li>
                        );
                    })
                }
            </ul>
        </nav>
    </div>

    <div
        class="px-4 pb-5 pt-1 flex self-center justify-center sticky bottom-10"
    >
        <LanguagePicker />
    </div>

    <div class="sticky bottom-0">
        <Social />
    </div>
</aside>

<div class="px-4 sm:ml-64" transition:animate="fade">
    <div class="md:flex md:justify-center">
        <main
            class:list={[
                "lg:pt-0 px-6",
                { "lg:max-w-[900px] max-w-[100vw]": !isProjectsPage },
            ]}
        >
            <slot />
        </main>
        <div class="md:hidden">
            <br />
            <Social />
        </div>
    </div>
</div>
