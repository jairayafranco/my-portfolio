---
import { Icon } from "astro-icon/components";
import Layout from "../../layouts/Layout.astro";
import { calculateTotalTime } from "../../utils/calculateTotalTime";
import { CV } from "../../data/cv";
import { getLangFromUrl } from "../../i18n/utils";
import { PROFILE } from "../../constants/profile";

const lang = getLangFromUrl(Astro.url);
const cvData = CV[lang];
const { experience, education, certificaciones } = cvData;
const { skills } = CV.en;
---

<Layout>
    <div class="pb-12 mt-5">
        <section class="mb-10">
            <h1 class="text-3xl w-full font-bold mb-5">Perfil</h1>
            <p class="text-lg">
                {PROFILE.bio[lang]}
            </p>
        </section>

        <section class="mb-10">
            <h2 class="text-3xl w-full font-bold mb-5">Experiencia</h2>
            <ol
                class="relative text-gray-500 border-l border-gray-200 dark:border-gray-700 dark:text-gray-400"
                aria-label="Línea de tiempo de experiencia laboral"
            >
                {
                    experience.map((exp) => (
                        <li class="mb-10 ml-6">
                            <span 
                                class="absolute flex items-center justify-center w-6 h-6 rounded-full -left-4 ring-4 ring-white dark:ring-gray-900 dark:bg-purple-900"
                                aria-hidden="true"
                            />
                            <h3 class="font-medium leading-tight text-lg">
                                {exp.name}
                            </h3>
                            <p class="font-light text-sm">
                                {exp.from} a {exp.to} en {exp.where}
                                {exp.from && exp.to && (
                                    <span> - {calculateTotalTime(exp.from, exp.to, lang)}</span>
                                )}
                            </p>
                            {exp.description && (
                                <p class="my-2 text-left">{exp.description}</p>
                            )}
                        </li>
                    ))
                }
            </ol>
        </section>

        <section class="mb-10">
            <h2 class="text-3xl w-full font-bold mb-5">Educación</h2>
            <ol
                class="relative text-gray-500 border-l border-gray-200 dark:border-gray-700 dark:text-gray-400"
                aria-label="Línea de tiempo de educación"
            >
                {
                    education.map((ed) => (
                        <li class="mb-10 ml-6">
                            <span 
                                class="absolute flex items-center justify-center w-6 h-6 rounded-full -left-4 ring-4 ring-white dark:ring-gray-900 dark:bg-purple-900"
                                aria-hidden="true"
                            />
                            <h3 class="font-medium leading-tight text-lg">
                                {ed.name}
                            </h3>
                            <p class="font-light text-sm">
                                {ed.from} a {ed.to} en {ed.where}
                            </p>
                        </li>
                    ))
                }
            </ol>
        </section>

        {certificaciones && certificaciones.length > 0 && (
            <section class="mb-10">
                <h2 class="text-3xl w-full font-bold mb-5">Certificaciones</h2>
                <ul class="list-disc mx-6 grid gap-2 md:grid-cols-2">
                    {certificaciones.map((cert) => <li>{cert}</li>)}
                </ul>
            </section>
        )}

        {skills && skills.length > 0 && (
            <section>
                <h2 class="text-3xl w-full font-bold mb-5">Habilidades</h2>
                <ul
                    class="list-none grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-5"
                    aria-label="Habilidades técnicas"
                >
                    {
                        skills.map((skill) => (
                            <li class="flex items-center gap-2">
                                <Icon
                                    name={skill.icon}
                                    class="inline-block w-6 h-6"
                                    aria-hidden="true"
                                />
                                <span>{skill.name}</span>
                            </li>
                        ))
                    }
                </ul>
            </section>
        )}
    </div>
</Layout>
