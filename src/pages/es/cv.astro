---
import { Icon } from "astro-icon/components";
import Layout from "../../layouts/Layout.astro";
import { calculateTotalTime } from "../../utils/calculateTotalTime";
import { CV } from "../../data/cv";
import { getLangFromUrl } from "../../i18n/utils";
import { PROFILE } from "../../constants/profile";

const lang = getLangFromUrl(Astro.url);
const cvData = CV[lang];
const { experience, education, certificaciones } = cvData;
const { skills } = CV.en;
---

<Layout>
    <div class="pb-12 mt-5 relative z-10">
        <section class="mb-10">
            <h1 class="text-4xl w-full font-bold mb-6 bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">Perfil</h1>
            <p class="text-lg text-gray-300 leading-relaxed">
                {PROFILE.bio[lang]}
            </p>
        </section>

        <section class="mb-10">
            <h2 class="text-3xl w-full font-bold mb-6 bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">Experiencia</h2>
            <ol
                class="relative text-gray-400 border-l-2 border-purple-500/30 dark:text-gray-400"
                aria-label="Línea de tiempo de experiencia laboral"
            >
                {
                    experience.map((exp) => (
                        <li class="mb-10 ml-6 group">
                            <span 
                                class="absolute flex items-center justify-center w-6 h-6 rounded-full -left-3.5 ring-4 ring-slate-900 bg-gradient-to-br from-purple-500 to-blue-500 shadow-lg shadow-purple-500/50 group-hover:shadow-purple-500/70 transition-all duration-300"
                                aria-hidden="true"
                            />
                            <h3 class="font-semibold leading-tight text-lg text-white">
                                {exp.name}
                            </h3>
                            <p class="font-light text-sm text-purple-300">
                                {exp.from} a {exp.to} en {exp.where}
                                {exp.from && exp.to && (
                                    <span> - {calculateTotalTime(exp.from, exp.to, lang)}</span>
                                )}
                            </p>
                            {exp.description && (
                                <p class="my-2 text-left text-gray-300">{exp.description}</p>
                            )}
                        </li>
                    ))
                }
            </ol>
        </section>

        <section class="mb-10">
            <h2 class="text-3xl w-full font-bold mb-6 bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">Educación</h2>
            <ol
                class="relative text-gray-400 border-l-2 border-purple-500/30 dark:text-gray-400"
                aria-label="Línea de tiempo de educación"
            >
                {
                    education.map((ed) => (
                        <li class="mb-10 ml-6 group">
                            <span 
                                class="absolute flex items-center justify-center w-6 h-6 rounded-full -left-3.5 ring-4 ring-slate-900 bg-gradient-to-br from-purple-500 to-blue-500 shadow-lg shadow-purple-500/50 group-hover:shadow-purple-500/70 transition-all duration-300"
                                aria-hidden="true"
                            />
                            <h3 class="font-semibold leading-tight text-lg text-white">
                                {ed.name}
                            </h3>
                            <p class="font-light text-sm text-purple-300">
                                {ed.from} a {ed.to} en {ed.where}
                            </p>
                        </li>
                    ))
                }
            </ol>
        </section>

        {certificaciones && certificaciones.length > 0 && (
            <section class="mb-10">
                <h2 class="text-3xl w-full font-bold mb-6 bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">Certificaciones</h2>
                <ul class="list-disc mx-6 grid gap-2 md:grid-cols-2">
                    {certificaciones.map((cert) => <li>{cert}</li>)}
                </ul>
            </section>
        )}

        {skills && skills.length > 0 && (
            <section>
                <h2 class="text-3xl w-full font-bold mb-6 bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">Habilidades</h2>
                <ul
                    class="list-none grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-5"
                    aria-label="Habilidades técnicas"
                >
                    {
                        skills.map((skill) => (
                            <li class="flex items-center gap-2 backdrop-blur-sm bg-slate-800/40 border border-white/10 rounded-lg px-3 py-2 hover:border-purple-500/50 hover:shadow-lg hover:shadow-purple-500/20 transition-all duration-300 hover:-translate-y-1">
                                <Icon
                                    name={skill.icon}
                                    class="inline-block w-6 h-6 text-purple-400"
                                    aria-hidden="true"
                                />
                                <span class="text-gray-200">{skill.name}</span>
                            </li>
                        ))
                    }
                </ul>
            </section>
        )}
    </div>
</Layout>
